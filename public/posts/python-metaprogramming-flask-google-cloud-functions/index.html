<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Python Metaprogramming: Functions, Flask and Google Cloud Functions | superuser</title>
<meta name="keywords" content="python">
<meta name="description" content="Everything in Python is an object. And that includes functions. Let&rsquo;s see what I learned while I was trying to work with Google cloud functions with python runtime.
Python Functions Since functions too are objects, we can see what all attributes a function contains as following
&gt;&gt;&gt; def hello(name): ... print(f&#34;Hello, {name}!&#34;) ... &gt;&gt;&gt; dir(hello) [&#39;__annotations__&#39;, &#39;__call__&#39;, &#39;__class__&#39;, &#39;__closure__&#39;, &#39;__code__&#39;, &#39;__defaults__&#39;, &#39;__delattr__&#39;, &#39;__dict__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__get__&#39;, &#39;__getattribute__&#39;, &#39;__globals__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__kwdefaults__&#39;, &#39;__le__&#39;, &#39;__lt__&#39;, &#39;__module__&#39;, &#39;__name__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__qualname__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;] While there are a lot of them, let&rsquo;s look at some interesting ones">
<meta name="author" content="Sanket">
<link rel="canonical" href="http://localhost:1313/posts/python-metaprogramming-flask-google-cloud-functions/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/python-metaprogramming-flask-google-cloud-functions/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap"
    rel="stylesheet">
  

<meta property="og:title" content="Python Metaprogramming: Functions, Flask and Google Cloud Functions" />
<meta property="og:description" content="Everything in Python is an object. And that includes functions. Let&rsquo;s see what I learned while I was trying to work with Google cloud functions with python runtime.
Python Functions Since functions too are objects, we can see what all attributes a function contains as following
&gt;&gt;&gt; def hello(name): ... print(f&#34;Hello, {name}!&#34;) ... &gt;&gt;&gt; dir(hello) [&#39;__annotations__&#39;, &#39;__call__&#39;, &#39;__class__&#39;, &#39;__closure__&#39;, &#39;__code__&#39;, &#39;__defaults__&#39;, &#39;__delattr__&#39;, &#39;__dict__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__get__&#39;, &#39;__getattribute__&#39;, &#39;__globals__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__kwdefaults__&#39;, &#39;__le__&#39;, &#39;__lt__&#39;, &#39;__module__&#39;, &#39;__name__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__qualname__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;] While there are a lot of them, let&rsquo;s look at some interesting ones" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/python-metaprogramming-flask-google-cloud-functions/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-11T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python Metaprogramming: Functions, Flask and Google Cloud Functions"/>
<meta name="twitter:description" content="Everything in Python is an object. And that includes functions. Let&rsquo;s see what I learned while I was trying to work with Google cloud functions with python runtime.
Python Functions Since functions too are objects, we can see what all attributes a function contains as following
&gt;&gt;&gt; def hello(name): ... print(f&#34;Hello, {name}!&#34;) ... &gt;&gt;&gt; dir(hello) [&#39;__annotations__&#39;, &#39;__call__&#39;, &#39;__class__&#39;, &#39;__closure__&#39;, &#39;__code__&#39;, &#39;__defaults__&#39;, &#39;__delattr__&#39;, &#39;__dict__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__get__&#39;, &#39;__getattribute__&#39;, &#39;__globals__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__init_subclass__&#39;, &#39;__kwdefaults__&#39;, &#39;__le__&#39;, &#39;__lt__&#39;, &#39;__module__&#39;, &#39;__name__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__qualname__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;] While there are a lot of them, let&rsquo;s look at some interesting ones"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Python Metaprogramming: Functions, Flask and Google Cloud Functions",
      "item": "http://localhost:1313/posts/python-metaprogramming-flask-google-cloud-functions/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python Metaprogramming: Functions, Flask and Google Cloud Functions",
  "name": "Python Metaprogramming: Functions, Flask and Google Cloud Functions",
  "description": "Everything in Python is an object. And that includes functions. Let\u0026rsquo;s see what I learned while I was trying to work with Google cloud functions with python runtime.\nPython Functions Since functions too are objects, we can see what all attributes a function contains as following\n\u0026gt;\u0026gt;\u0026gt; def hello(name): ... print(f\u0026#34;Hello, {name}!\u0026#34;) ... \u0026gt;\u0026gt;\u0026gt; dir(hello) [\u0026#39;__annotations__\u0026#39;, \u0026#39;__call__\u0026#39;, \u0026#39;__class__\u0026#39;, \u0026#39;__closure__\u0026#39;, \u0026#39;__code__\u0026#39;, \u0026#39;__defaults__\u0026#39;, \u0026#39;__delattr__\u0026#39;, \u0026#39;__dict__\u0026#39;, \u0026#39;__dir__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__eq__\u0026#39;, \u0026#39;__format__\u0026#39;, \u0026#39;__ge__\u0026#39;, \u0026#39;__get__\u0026#39;, \u0026#39;__getattribute__\u0026#39;, \u0026#39;__globals__\u0026#39;, \u0026#39;__gt__\u0026#39;, \u0026#39;__hash__\u0026#39;, \u0026#39;__init__\u0026#39;, \u0026#39;__init_subclass__\u0026#39;, \u0026#39;__kwdefaults__\u0026#39;, \u0026#39;__le__\u0026#39;, \u0026#39;__lt__\u0026#39;, \u0026#39;__module__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__ne__\u0026#39;, \u0026#39;__new__\u0026#39;, \u0026#39;__qualname__\u0026#39;, \u0026#39;__reduce__\u0026#39;, \u0026#39;__reduce_ex__\u0026#39;, \u0026#39;__repr__\u0026#39;, \u0026#39;__setattr__\u0026#39;, \u0026#39;__sizeof__\u0026#39;, \u0026#39;__str__\u0026#39;, \u0026#39;__subclasshook__\u0026#39;] While there are a lot of them, let\u0026rsquo;s look at some interesting ones",
  "keywords": [
    "python"
  ],
  "articleBody": "Everything in Python is an object. And that includes functions. Let’s see what I learned while I was trying to work with Google cloud functions with python runtime.\nPython Functions Since functions too are objects, we can see what all attributes a function contains as following\n\u003e\u003e\u003e def hello(name): ... print(f\"Hello, {name}!\") ... \u003e\u003e\u003e dir(hello) ['__annotations__', '__call__', '__class__', '__closure__', '__code__', '__defaults__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__get__', '__getattribute__', '__globals__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__kwdefaults__', '__le__', '__lt__', '__module__', '__name__', '__ne__', '__new__', '__qualname__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__'] While there are a lot of them, let’s look at some interesting ones\nglobals This attribute, as the name suggests, has references of global variables. If you ever need to know what all global variables are in the scope of this function, this will tell you. See how the function start seeing the new variable in globals\n\u003e\u003e\u003e hello.__globals__ {'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': \u003cclass '_frozen_importlib.BuiltinImporter'\u003e, '__spec__': None, '__annotations__': {}, '__builtins__': ",
  "wordCount" : "1087",
  "inLanguage": "en",
  "datePublished": "2020-08-11T00:00:00Z",
  "dateModified": "2020-08-11T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Sanket"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/python-metaprogramming-flask-google-cloud-functions/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "superuser",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="superuser (Alt + H)">superuser</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://sanket.plus" title="About Me">
                    <span>About Me</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Python Metaprogramming: Functions, Flask and Google Cloud Functions
    </h1>
    <div class="post-meta"><span title='2020-08-11 00:00:00 +0000 UTC'>August 11, 2020</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Sanket

</div>
  </header> 
  <div class="post-content"><p>Everything in Python is an object. And that includes functions. Let&rsquo;s see what I learned while I was trying to work with Google cloud functions with python runtime.</p>
<h2 id="python-functions">Python Functions<a hidden class="anchor" aria-hidden="true" href="#python-functions">#</a></h2>
<p>Since functions too are objects, we can see what all attributes a function contains as following</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hello</span>(name):
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>     print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Hello, </span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> dir(hello)
</span></span><span style="display:flex;"><span>[<span style="color:#e6db74">&#39;__annotations__&#39;</span>, <span style="color:#e6db74">&#39;__call__&#39;</span>, <span style="color:#e6db74">&#39;__class__&#39;</span>, <span style="color:#e6db74">&#39;__closure__&#39;</span>, <span style="color:#e6db74">&#39;__code__&#39;</span>, <span style="color:#e6db74">&#39;__defaults__&#39;</span>, <span style="color:#e6db74">&#39;__delattr__&#39;</span>, <span style="color:#e6db74">&#39;__dict__&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;__dir__&#39;</span>, <span style="color:#e6db74">&#39;__doc__&#39;</span>, <span style="color:#e6db74">&#39;__eq__&#39;</span>, <span style="color:#e6db74">&#39;__format__&#39;</span>, <span style="color:#e6db74">&#39;__ge__&#39;</span>, <span style="color:#e6db74">&#39;__get__&#39;</span>, <span style="color:#e6db74">&#39;__getattribute__&#39;</span>, <span style="color:#e6db74">&#39;__globals__&#39;</span>, <span style="color:#e6db74">&#39;__gt__&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;__hash__&#39;</span>, <span style="color:#e6db74">&#39;__init__&#39;</span>, <span style="color:#e6db74">&#39;__init_subclass__&#39;</span>, <span style="color:#e6db74">&#39;__kwdefaults__&#39;</span>, <span style="color:#e6db74">&#39;__le__&#39;</span>, <span style="color:#e6db74">&#39;__lt__&#39;</span>, <span style="color:#e6db74">&#39;__module__&#39;</span>, <span style="color:#e6db74">&#39;__name__&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;__ne__&#39;</span>, <span style="color:#e6db74">&#39;__new__&#39;</span>, <span style="color:#e6db74">&#39;__qualname__&#39;</span>, <span style="color:#e6db74">&#39;__reduce__&#39;</span>, <span style="color:#e6db74">&#39;__reduce_ex__&#39;</span>, <span style="color:#e6db74">&#39;__repr__&#39;</span>, <span style="color:#e6db74">&#39;__setattr__&#39;</span>, <span style="color:#e6db74">&#39;__sizeof__&#39;</span>, <span style="color:#e6db74">&#39;__str__&#39;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;__subclasshook__&#39;</span>]
</span></span></code></pre></div><p>While there are a lot of them, let&rsquo;s look at some interesting ones</p>
<h3 id="__globals__"><strong>globals</strong><a hidden class="anchor" aria-hidden="true" href="#__globals__">#</a></h3>
<p>This attribute, as the name suggests, has references of global variables. If you ever need to know what all global variables are in the scope of this function, this will tell you. See how the function start seeing the new variable in globals</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__globals__
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#39;__name__&#39;</span>: <span style="color:#e6db74">&#39;__main__&#39;</span>, <span style="color:#e6db74">&#39;__doc__&#39;</span>: <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;__package__&#39;</span>: <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;__loader__&#39;</span>: <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">_frozen_importlib</span><span style="color:#f92672">.</span>BuiltinImporter<span style="color:#e6db74">&#39;&gt;, &#39;</span>__spec__<span style="color:#e6db74">&#39;: None, &#39;</span>__annotations__<span style="color:#e6db74">&#39;: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">, &#39;</span>__builtins__<span style="color:#e6db74">&#39;: &lt;module &#39;</span>builtins<span style="color:#e6db74">&#39; (built-in)&gt;, &#39;</span>hello<span style="color:#e6db74">&#39;: &lt;function hello at 0x7fe4e82554c0&gt;}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># adding new global variable</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> GLOBAL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;g_val&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__globals__
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#39;__name__&#39;</span>: <span style="color:#e6db74">&#39;__main__&#39;</span>, <span style="color:#e6db74">&#39;__doc__&#39;</span>: <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;__package__&#39;</span>: <span style="color:#66d9ef">None</span>, <span style="color:#e6db74">&#39;__loader__&#39;</span>: <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">_frozen_importlib</span><span style="color:#f92672">.</span>BuiltinImporter<span style="color:#e6db74">&#39;&gt;, &#39;</span>__spec__<span style="color:#e6db74">&#39;: None, &#39;</span>__annotations__<span style="color:#e6db74">&#39;: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">, &#39;</span>__builtins__<span style="color:#e6db74">&#39;: &lt;module &#39;</span>builtins<span style="color:#e6db74">&#39; (built-in)&gt;, &#39;</span>hello<span style="color:#e6db74">&#39;: &lt;function hello at 0x7fe4e82554c0&gt;, &#39;</span>GLOBAL<span style="color:#e6db74">&#39;: &#39;</span>g_val<span style="color:#e6db74">&#39;}</span>
</span></span></code></pre></div><h3 id="__code__"><strong>code</strong><a hidden class="anchor" aria-hidden="true" href="#__code__">#</a></h3>
<p>This is an interesting one! As everything in python is an object, this includes the bytecode too. The compiled python bytecode is a python code object. Which is accessible via <code>__code__</code> attribute here. A function has an associated code object which carries some interesting information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># the file in which function is defined</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># stdin here since this is run in an interpreter</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__code__<span style="color:#f92672">.</span>co_filename
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&lt;stdin&gt;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># number of arguments the function takes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__code__<span style="color:#f92672">.</span>co_argcount
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># local variable names</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__code__<span style="color:#f92672">.</span>co_varnames
</span></span><span style="display:flex;"><span>(<span style="color:#e6db74">&#39;name&#39;</span>,)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the function code&#39;s compiled bytecode</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__code__<span style="color:#f92672">.</span>co_code
</span></span><span style="display:flex;"><span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;t</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">d</span><span style="color:#ae81ff">\x01</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\x00\x9b\x00</span><span style="color:#e6db74">d</span><span style="color:#ae81ff">\x02\x9d\x03\x83\x01\x01\x00</span><span style="color:#e6db74">d</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">S</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>
</span></span></code></pre></div><p>There are more code attributes which you can enlist by <code>&gt;&gt;&gt; dir(hello.__code__)</code></p>
<h3 id="function-attributes">Function Attributes<a hidden class="anchor" aria-hidden="true" href="#function-attributes">#</a></h3>
<p>This might sound weird at first but you can do <code>function_name.foo='bar'</code>, like it is an object! (it is, though) These are function attributes and it will be associated with the function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>foo<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bar&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>foo
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;bar&#39;</span>
</span></span></code></pre></div><p>How does this work? The famous <code>__dict__</code> attribute which carries these fellas.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> hello<span style="color:#f92672">.</span>__dict__
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#39;foo&#39;</span>: <span style="color:#e6db74">&#39;bar&#39;</span>}
</span></span></code></pre></div><p>I personally have not yet come across any use for this feature. There are some explained in this feature&rsquo;s proposal at <a href="https://www.python.org/dev/peps/pep-0232/">PEP 232</a></p>
<h2 id="the-cloud-functions">The Cloud Functions<a hidden class="anchor" aria-hidden="true" href="#the-cloud-functions">#</a></h2>
<p>Cloud functions, as the name suggest, run a unit of code, that is a function. Here is what a Hello World would look like</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hello_world</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Responds to any HTTP request.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        request (flask.Request): HTTP request object.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        The response text or any set of values that can be turned into a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Response object using
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        `make_response &lt;http://flask.pocoo.org/docs/1.0/api/#flask.Flask.make_response&gt;`.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    request_json <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>args <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;message&#39;</span> <span style="color:#f92672">in</span> request<span style="color:#f92672">.</span>args:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;message&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> request_json <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;message&#39;</span> <span style="color:#f92672">in</span> request_json:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> request_json[<span style="color:#e6db74">&#39;message&#39;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Hello World!&#39;</span>
</span></span></code></pre></div><p>A cloud function should be expecting a Flask&rsquo;s <code>request</code> object as a parameter. This function will be accessible under <code>https://&lt;some-domain&gt;.com/hello_world</code>. The endpoint name is the same as the function name</p>
<p>Now, of course, you won&rsquo;t have just one function and you would want to test/run these functions locally. <strong>Since the injected <code>request</code> parameter is of flask, there needs to be a way to run this function with flask locally</strong></p>
<h2 id="flask">Flask<a hidden class="anchor" aria-hidden="true" href="#flask">#</a></h2>
<p>While working with flask, functions are generally decorated with flask&rsquo;s <code>@app.route</code> decorator and flask would be injecting parameters to that functions if any. HTTP request&rsquo;s content is accessed by a global variable like <code>from flask import request</code> while the cloud function expects it as a parameter to function.</p>
<p>To overcome this, we can create a function that wraps the google cloud&rsquo;s above function. Something like</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, request
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">=</span>Flask(<span style="color:#e6db74">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/hello_world&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hello_test</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> hello_world(request)
</span></span></code></pre></div><p>Sweet! This works as expected. But there is one issue though. <strong>If there are a lot of google functions, an equal number of test functions will be required.</strong></p>
<h1 id="enters-the-metaprogrammer">Enters the Metaprogrammer<a hidden class="anchor" aria-hidden="true" href="#enters-the-metaprogrammer">#</a></h1>
<p>Python is a dynamic language, so let&rsquo;s make use of it. Here&rsquo;s the plan</p>
<ol>
<li>Discover the google functions dynamically</li>
<li>Create wrapper function which generates flask compatible functions out of step 1 above</li>
<li>Register them to our test flask app dynamically</li>
</ol>
<h3 id="lets-discover">Let&rsquo;s Discover<a hidden class="anchor" aria-hidden="true" href="#lets-discover">#</a></h3>
<p>If all the functions are in one file, discovering them would look like this. We import the module which contains all the functions, we go through each variable in that module and take a note of all the callable ones (ie: the functions)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># suppose all the functions are defined in main.py</span>
</span></span><span style="display:flex;"><span>local_vars <span style="color:#f92672">=</span> importlib<span style="color:#f92672">.</span>import_module(<span style="color:#e6db74">&#34;main&#34;</span>)<span style="color:#f92672">.</span>__dict__
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> name, value <span style="color:#f92672">in</span> local_vars<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> callable(value):
</span></span><span style="display:flex;"><span>        print(name)
</span></span></code></pre></div><h3 id="wrapper-function">Wrapper function<a hidden class="anchor" aria-hidden="true" href="#wrapper-function">#</a></h3>
<p>GCF&rsquo;s function takes request as a parameter which would be incompatible with the function that flask&rsquo;s route decorator takes. For this, what we can do is create a wrapper function which will call our original google function. And original function takes imported <code>request</code> arg. So <code>make_function</code> here is a closure.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> request
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> flask<span style="color:#f92672">.</span>Flask(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_function</span>(f):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_function</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> f(request)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> _function
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wrapped_hello_world <span style="color:#f92672">=</span> make_function(hello_world)
</span></span></code></pre></div><h3 id="register-routes">Register Routes<a hidden class="anchor" aria-hidden="true" href="#register-routes">#</a></h3>
<p>Once we have the wrapped function, we can register it with flask.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>app<span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#34;/hello_world&#34;</span>)(wrapped_hello_world)
</span></span></code></pre></div><p>This works well. But as soon as the second wrapper function is registered, it greets us with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> app<span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#34;/hi&#34;</span>)(make_function(hi))
</span></span><span style="display:flex;"><span>Traceback (most recent call last):
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;&lt;stdin&gt;&#34;</span>, line <span style="color:#ae81ff">1</span>, <span style="color:#f92672">in</span> <span style="color:#f92672">&lt;</span>module<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/sanket/venv/lib/python3.8/site-packages/flask/app.py&#34;</span>, line <span style="color:#ae81ff">1315</span>, <span style="color:#f92672">in</span> decorator
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>add_url_rule(rule, endpoint, f, <span style="color:#f92672">**</span>options)
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/sanket/venv/lib/python3.8/site-packages/flask/app.py&#34;</span>, line <span style="color:#ae81ff">98</span>, <span style="color:#f92672">in</span> wrapper_func
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> f(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/sanket/venv/lib/python3.8/site-packages/flask/app.py&#34;</span>, line <span style="color:#ae81ff">1282</span>, <span style="color:#f92672">in</span> add_url_rule
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">AssertionError</span>(
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">AssertionError</span>: View function mapping <span style="color:#f92672">is</span> overwriting an existing endpoint function: _function
</span></span></code></pre></div><p>The error is saying a function called <code>_function</code> already exits for another endpoint. If you look closer, the wrapper returns a function named <code>_function</code> and Flask seems to be using function&rsquo;s name while registering routes. So we cannot have functions with the same name under different routes. Though functions returned by the <code>make_function</code> are different, they have the same name.</p>
<p>Now scrolling back up, a function has an attribute called <code>__name__</code>. Flask would be using this to get the function&rsquo;s name. Since we know functions we return are different functions, we can change the function&rsquo;s name before returning it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_function</span>(f):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_function</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> f(request)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    _function<span style="color:#f92672">.</span>__name__ <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>__name__
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> _function
</span></span></code></pre></div><p>And then it goes smooth!</p>
<p>So here is the final version</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> importlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> request
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> flask<span style="color:#f92672">.</span>Flask(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_function</span>(f):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_function</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> f(request)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># setting the name correctly so that flask does not complain</span>
</span></span><span style="display:flex;"><span>    _function<span style="color:#f92672">.</span>__name__ <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>__name__
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> _function
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>local_vars <span style="color:#f92672">=</span> importlib<span style="color:#f92672">.</span>import_module(<span style="color:#e6db74">&#34;main&#34;</span>)<span style="color:#f92672">.</span>__dict__
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> name, value <span style="color:#f92672">in</span> local_vars<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> callable(value):
</span></span><span style="display:flex;"><span>        app<span style="color:#f92672">.</span>route(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)(make_function(value))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>run()
</span></span></code></pre></div><p>Oh and later one day I realized <a href="https://docs.python.org/3/library/functools.html#functools.wraps">functools.wraps</a> also renames the function along with couple other things.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/python/">Python</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/srecon-21-ml-application-hotspot-detect/">
    <span class="title">« Prev</span>
    <br>
    <span>SRECon&#39;21: Leveraging ML to Detect Application HotSpots [@scale, of Course!]</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/golang-http-gzip-compression/">
    <span class="title">Next »</span>
    <br>
    <span>Golang Http Client and Compression</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">superuser</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
