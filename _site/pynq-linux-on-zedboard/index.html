<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>PYNQ Linux on ZedBoard - Site Title</title>
<meta name="description" content="Hi There!">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Site Title">
<meta property="og:title" content="PYNQ Linux on ZedBoard">
<meta property="og:url" content="http://localhost:4000/pynq-linux-on-zedboard/">


  <meta property="og:description" content="Hi There!">







  <meta property="article:published_time" content="2017-05-08T00:39:58+05:30">





  

  


<link rel="canonical" href="http://localhost:4000/pynq-linux-on-zedboard/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Your Name",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Site Title Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Site Title</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/" >Quick-Start Guide</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="PYNQ Linux on ZedBoard">
    <meta itemprop="description" content="Hi There!">
    <meta itemprop="datePublished" content="May 08, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">PYNQ Linux on ZedBoard
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Hi There!</p>

<p>The PYNQ Linux is a fun, easy and maker-friendly Ubuntu 15.04 rootfs. It comes bundled with the PYNQ-Z1 board, and the official documentations doesn’t even utter a word on how to build or port this image on any other Zynq. Maybe because it’s too obvious how to do so.</p>

<!--more-->

<p>What you need to run Linux on any ARM board?</p>

<ol>
  <li>BOOT image (BOOT.bin)</li>
  <li>kernel image (uImage)</li>
  <li>devicetree blob (devicetree.dtb)</li>
  <li>rootfs</li>
</ol>

<p>What we need to worry about? everything but the rootfs.</p>

<h2 id="tldr"><strong>TL;DR</strong></h2>

<blockquote>
  <p>Write the image file on SD card same as in the pynq tutorial, and replace the files in BOOT partition with these…
	<a class="download-link" title="Version 1.0" href="https://superuser.blog/download/160/" rel="nofollow"> ZedBoard BOOT files</a></p>

  <p><strong>Update:</strong></p>

  <p>use older image of pynq from <a href="https://files.digilent.com/Products/PYNQ/pynq_z1_image_2016_09_14.zip">here</a></p>
</blockquote>

<h2 id="detailed-explanationas-if-you-asked-for-it">Detailed Explanation (as if you asked for it)</h2>

<h3 id="0-set-up-environment">0. Set up environment.</h3>

<p>You’ll obviously need to do this all a Desktop Linux system. I’ve tried doing onWindows, doesn’t work well with MinGW. Haven’t tried CygWin or Linux Subsystem for Windows, you may give it a try if you’re brave enough.</p>

<h4 id="01-set-up-the-bash-environment-to-work-with-xilinx-sdk-tools">0.1 Set up the Bash environment to work with Xilinx SDK tools,</h4>

<pre class="lang:default decode:true">source /opt/Xilinx/SDK/2016.3/settings64.sh
source /opt/Xilinx/Vivado/2016.3/settings64.sh
# For Older SDKs before 2017.1
export CROSS_COMPILE=arm-xilinx-linux-gnueabi-
</pre>

<p><strong>Update:</strong></p>

<p>For latest SDK version 2017.3 the cross compiler is arm-linux-gnueabihf-gcc.</p>

<pre class="lang:default decode:true"># For new SDKs on or after 2017.1
export CROSS_COMPILE=arm-linux-gnueabihf-gcc-</pre>

<h4 id="02-sd-card-patitioning">0.2 SD Card Patitioning</h4>

<p>you don’t really need to create partitions of the SD card because loading the image file from the PYNQ linux will do that for you, however you can do it anyways which should look like… (Use GParted or something)</p>

<p>Partition-1:</p>

<ul>
  <li>Type: fat32</li>
  <li>Free Space Preceding: 4MB (IMPORTANT!!!)</li>
  <li>Size: 52MB</li>
  <li>Label: BOOT (Optional)</li>
</ul>

<p>Partition-2:</p>

<ul>
  <li>Type: ext4</li>
  <li>Size: whatever is left</li>
  <li>Label: rootfs (Optional)</li>
</ul>

<h4 id="notes">Notes</h4>

<ul>
  <li>DO NOT REMOVE SD CARD WITHOUT UNMOUNTING IT! Really, don’t. It creates badblocks in the SD card which might cause issues booting up the Zynq.</li>
  <li>You can check my GitHub @parthpower for the modified u-boot and Linux codes to work around this.</li>
</ul>

<h3 id="1-make-bootbin">1. Make BOOT.bin</h3>

<p>-&gt; To create BOOT.bin, you’ll need 3 things (which you’d have heard everywhere).</p>

<ol>
  <li>First Stage Bootloader to dump the bitstream and call the second stage bootloader</li>
  <li>bitstream</li>
  <li>Second Stage Bootloader (u-boot.elf)</li>
</ol>

<p>I’m not going in details of first two things, as they are simple and you can just google them… Come on now! Ok, in short, make Vivado project with only PS, export it to the SDK, create FSLB application project and you’re good!</p>

<p>Let’s get to the main part, MAKING u-boot.elf!!!!</p>

<p>Clone the Xilinx UBoot repo from the Xilinx github, checkout to the latest stable release (I used xilinx-v2016.4) (in case you need code)</p>

<pre class="lang:default decode:true" title="Git checkout">git clone //github.com/Xilinx/u-boot-xlnx.git
cd u-boot-xlnx
git checkout xilinx-v2016.4</pre>

<p>Now, you got to change some stuff in u-boot-xlnx/include/configs/zynq-common.h, find this line “sdboot=if mmcinfo;” and make it look like as below</p>

<pre class="lang:default decode:true">"sdboot=if mmcinfo; then " \
			"run uenvboot; " \
			"echo Copying Linux from SD to RAM...RFS in ext4 &amp;&amp; " \
			"load mmc 0 ${kernel_load_address} ${kernel_image} &amp;&amp; " \
			"load mmc 0 ${devicetree_load_address} ${devicetree_image} &amp;&amp; " \
			"bootm ${kernel_load_address} - ${devicetree_load_address}; " \</pre>

<p> </p>

<p>Wait, what did we just messed with? Like what the hell happened?</p>

<p>If you go through the “Ubuntu on ZedBoard” tutorial by Avnet, they explain it’s for using the rootfs from the filesystem instead of a RAM disk.</p>

<p>To make u-boot,</p>

<pre class="lang:default decode:true">make zynq_zed_config
make</pre>

<p>You should add _u-boot-xlnx/tools _to the PATH. It’ll be useful making the Linux Image later on.</p>

<pre class="lang:default decode:true">export PATH='uboot-xlnx/tools:'$PATH</pre>

<p>Get the “u-boot” file from the root of the u-boot source directory, rename it to u-boot.elf. Now just make the <strong>BOOT.bin</strong>, open “Create Boot Image” in SDK use the FSBL.elf, bit file and the u-boot.elf. Mind the order of the files because that’s how the Zynq will be booted. FSBL configures the PL with the bit file then loads the second stage bootloader; u-boot.</p>

<p><img class="alignnone size-full wp-image-148" src="//superuser.blog/wp-content/uploads/2017/05/BOOT.png" alt="" width="764" height="997" srcset="https://superuser.blog/wp-content/uploads/2017/05/BOOT.png 764w, https://superuser.blog/wp-content/uploads/2017/05/BOOT-230x300.png 230w" sizes="(max-width: 764px) 100vw, 764px" /></p>

<p> </p>

<h3 id="2-make-linux-kernel-image">2. Make Linux Kernel Image</h3>

<p>The Linux Kernel Image is the actual Kernel being loaded by the u-boot and which has the rootfs of pynq distribution. In less technical words, Linux Kernel is the base system which loads the higher-level root filesystem from the mount point. Now we’re done with the theory part, Let’s make the kernel!</p>

<p>Fetch the sources,</p>

<pre class="lang:default decode:true">git clone //github.com/Xilinx/linux-xlnx.git
git checkout -b xlnx_3.17</pre>

<p>Just default config, and make it!</p>

<pre class="lang:default decode:true">make ARCH=arm xilinx_zynq_defconfig

make ARCH=arm UIMAGE_LOADADDR=0x8000 uImage
</pre>

<p>That’s it and you have your Linux kernel image ready at _linux-xlnx/arch/arm/boot/<strong>uImage</strong> _save it somewhere safe.</p>

<h3 id="3-device-tree-blob">3. Device Tree Blob</h3>

<p>What? Device tree blob is a “block-of-binary” which specifies memory location of the peripherals, their compatible driver names, and some configurations of the peripherals. It’s lots of information about the hardware specification of the SoC.</p>

<p>The dtb is compiled from dts (device tree string). For a PS-only design, the dts is already there in the linux-xlnx repository at <em>/linux-xlnx/arch/arm/boot/dts/zynq-zed.dts</em></p>

<p>We need to modify it a little bit to load the rootfs, (yeah, lots of efforts just to load the rootfs)</p>

<p>find the line starting with _bootargs _and change it to,</p>

<pre class="lang:default decode:true">bootargs = "console=ttyPS0,115200 root=/dev/mmcblk0p2 rw earlyprintk rootfstype=ext4 rootwait devtmpfs.mount=1";</pre>

<p>By default, it has bootargs are set to load the rootfs from a ramdisk. But we configured the u-boot not to load the rootfs as ramdisk. So we are mounting it from /dev/mmcblk0p2 (partition 2 of the memory card)</p>

<p>Now go to the root of linux-xlnx and</p>

<pre class="lang:default decode:true ">make ARCH=arm zynq-zed.dtb</pre>

<p>and you have the dtb file at  <em>/linux-xlnx/arch/arm/boot/dts/<strong>zynq-zed.dtb</strong></em> rename it to devicetree.dtb and copy it somewhere safe.</p>

<h3 id="4-rootfs">4. rootfs</h3>

<p>The root file system we want to use if the one provided by the PYNQ. Download the latest version from //pynq.io. Extract it, and write the image to the sd card. Use _dd _or Win32DiskImage tool or whatever you wish.</p>

<blockquote>
  <p><strong>Update:</strong></p>

  <p>The latest PYNQ distribution has kernel v4.6. You can use older image from,</p>

  <p><a href="https://files.digilent.com/Products/PYNQ/pynq_z1_image_2016_09_14.zip" target="_blank" rel="noopener">https://files.digilent.com/Products/PYNQ/pynq_z1_image_2016_09_14.zip</a></p>
</blockquote>

<p>Mount the SD card, look into the BOOT partition, replace all the files, BOOT.bin, uImage, devicetree.dtb with the ones we’ve created, and you’re done. Seriously, you’re done!</p>

<p>Good thing is, you can put any Linux distribution as long as it is made up on Linux Kernel 3.17 in the rootfs file system and it should work. I tried Linaro , it quite didn’t work well with me. Try playing around, let me know what works and what don’t work!</p>

<p>Happy Hacking!</p>

<p>Some Really Good References,</p>

<p><a href="//www.instructables.com/id/Embedded-Linux-Tutorial-Zybo/" target="_blank" rel="noopener noreferrer">//www.instructables.com/id/Embedded-Linux-Tutorial-Zybo/ </a></p>

<p><a href="//forums.xilinx.com/xlnx/attachments/xlnx/ELINUX/12801/1/Ubuntu_on_Zynq_Tutorial_03.pdf" target="_blank" rel="noopener noreferrer">//forums.xilinx.com/xlnx/attachments/xlnx/ELINUX/12801/1/Ubuntu_on_Zynq_Tutorial_03.pdf </a></p>

<p><a href="//fpga.org/2013/05/24/yet-another-guide-to-running-linaro-ubuntu-desktop-on-xilinx-zynq-on-the-zedboard/" target="_blank" rel="noopener noreferrer">//fpga.org/2013/05/24/yet-another-guide-to-running-linaro-ubuntu-desktop-on-xilinx-zynq-on-the-zedboard/</a></p>

<p><a href="//www.wiki.xilinx.com/" target="_blank" rel="noopener noreferrer">//www.wiki.xilinx.com/</a></p>

<h1 id="update"><strong>Update</strong></h1>

<ol>
  <li>PYNQ has recently updated their repository and included instructions to make sd card image section. <a href="https://pynq.readthedocs.io/en/latest/pynq_sd_card.html" target="_blank" rel="noopener">https://pynq.readthedocs.io/en/latest/pynq_sd_card.html</a>  Thanks to <b class="fn">Cathal McCabe </b>for this update.</li>
</ol>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#fpga" class="page__taxonomy-item" rel="tag">FPGA</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#linux" class="page__taxonomy-item" rel="tag">linux</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#zynq" class="page__taxonomy-item" rel="tag">Zynq</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#fpga" class="page__taxonomy-item" rel="tag">FPGA</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#linux" class="page__taxonomy-item" rel="tag">Linux</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#zynq" class="page__taxonomy-item" rel="tag">Zynq</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-05-08T00:39:58+05:30">May 08, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=PYNQ+Linux+on+ZedBoard%20http%3A%2F%2Flocalhost%3A4000%2Fpynq-linux-on-zedboard%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fpynq-linux-on-zedboard%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fpynq-linux-on-zedboard%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fpynq-linux-on-zedboard%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/migrate-opentsdb-hbase/" class="pagination--pager" title="Migrating OpenTSDB to Another HBase Cluster
">Previous</a>
    
    
      <a href="/reconfigure-zynq-pl-go/" class="pagination--pager" title="How to reconfigure Zynq-PL on-the-go?
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/jekyll/update/welcome-to-jekyll/" rel="permalink">Welcome to Jekyll!
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">You’ll find this post in your _posts directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different wa...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/aws-vpc-peering-latency-test/" rel="permalink">Setting up Inter Region AWS VPC Peering and Latency Tests
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Most of our infrastructure and client facing services are in us-east-1 and we have lots of users connecting from different parts of the world including India...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/upgrading-apache-phoenix-hdp/" rel="permalink">Upgrading Apache Phoenix in HDP Cluster
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">About new Hadoop cluster we set up, the phoenix version bundled with HDP distribution(4.7) had some bugs which would make it impossible to use to run BI quer...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/tcp-fast-open-python/" rel="permalink">TCP Fast Open: In Action with Python
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Recently I was revisiting concepts of TCP protocol and that reminded me that there was also a thing called TCP Fast Open. Digging further on the same reveale...</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.9/js/all.js"></script>








  </body>
</html>